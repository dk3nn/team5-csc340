<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="home.css">
    <link rel="stylesheet" href="profile-detail.css">
    <script src="samplecardata.js"></script>
    <title>Auto-Pick Home</title>
</head>
<body>
    <div id="home-body">
        <div id="navbar">
            <h2 id="name">Auto-Pick</h2>
            <div id="navbar-links">
                <a href="home.html">Home</a>
                <a href="#">About</a>
                <a href="#">Contact</a>
            </div>
            <div id="btn-container">
                <a id="link-to-dashboard"></a>
            </div>
        </div>
        <div id="heading">
            <h1 style="text-align: center;">Welcome to Auto-Pick</h1>
            <p style="text-align: center;">Step to finding a new car</p>
        </div>
        <div id="outer-container">
            <div class="profile-container">
                <h2>Dealer Profile</h2>

                <div class="profile-row">
                    <label>Name:</label>
                    <input type="text" id="dealername" disabled>
                </div>

                <div class="profile-row">
                    <label>Email:</label>
                    <input type="email" id="email" disabled>
                </div>

                <div class="profile-row">
                    <label>Phone:</label>
                    <input type="text" id="phone" disabled>
                </div>

                <div class="profile-row">
                    <label>Address:</label>
                    <input type="text" id="address" disabled>
                </div>

                <div class="profile-row">
                    <label>Password:</label>
                    <input type="password" id="password" disabled>
                </div>

                <div class="btn-group">
                    <button id="edit-btn">Edit</button>
                    <button id="save-btn" style="display:none;">Save</button>
                    <button id="delete-btn" class="danger">Delete Account</button>
                </div>
            </div>
        </div>

        <div id="footer">
            <p>Copyright 2025</p>
        </div>
    </div>

    <script>
        // Get dealerId from URL
        const urlParams = new URLSearchParams(window.location.search);
        const dealerId = urlParams.get('dealerId');

        // Fetch dealer details
        fetch(`http://127.0.0.1:8080/api/dealers/${dealerId}`)
        .then(response => response.json())
        .then(dealer => {
            document.getElementById('dealername').value = dealer.name;
            document.getElementById('email').value = dealer.email;
            document.getElementById('phone').value = dealer.phoneNumber;
            document.getElementById('address').value = dealer.address;

            // Set dashboard link
            const dashboardLink = document.getElementById('link-to-dashboard');
            dashboardLink.textContent = 'Dashboard';
            dashboardLink.href = `provider/dashboard.html?dealerId=${dealer.id}`;
        });


        // Edit and Save functionality
        const editBtn = document.getElementById('edit-btn');
        const saveBtn = document.getElementById('save-btn');
        editBtn.addEventListener('click', () => {
            document.getElementById('dealername').disabled = false;
            document.getElementById('email').disabled = false;
            document.getElementById('phone').disabled = false;
            document.getElementById('address').disabled = false;
            document.getElementById('password').disabled = false;
            editBtn.style.display = 'none';
            saveBtn.style.display = 'inline-block';
        });
    
        saveBtn.addEventListener('click', () => {
            const updatedDealer = {
                name: document.getElementById('dealername').value,
                email: document.getElementById('email').value,
                phoneNumber: document.getElementById('phone').value,
                address: document.getElementById('address').value,
                password: document.getElementById('password').value
            };

            fetch(`http://127.0.0.1:8080/api/dealers/${dealerId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(updatedDealer)
            })

            .then(response => {
                if (response.ok) {
                    alert('Profile updated successfully!');
                    document.getElementById('dealername').disabled = true;
                    document.getElementById('email').disabled = true;
                    document.getElementById('phone').disabled = true;
                    document.getElementById('address').disabled = true;
                    document.getElementById('password').disabled = true;
                    editBtn.style.display = 'inline-block';
                    saveBtn.style.display = 'none';
                } else {
                    alert('Error updating profile.');
                }
            });

        });

        // Delete account functionality
        const deleteBtn = document.getElementById('delete-btn');
        deleteBtn.addEventListener('click', () => {
            fetch(`http://127.0.1:8080/api/dealers/${dealerId}`, {
                method: 'DELETE'
            })  
            .then(response => {
                if (response.ok) {
                    alert('Account deleted successfully.');
                    window.location.href = 'home.html';
                } else {
                    alert('Error deleting account.');
                }
            });
        });
    </script>
</body>
</html>